{% schema %}
{
  "name": "Sudoku Game",
  "target": "section",
  "settings": []
}
{% endschema %}

<div id="sudoku-root"></div>

<script>
  (function() {
    // Small 4x4 Sudoku so it's easy to see and test

    // null = empty cell for the user
    const puzzle = [
      [1, null, null, 4],
      [null, 3, 1, null],
      [null, 1, 4, null],
      [2, null, null, 3]
    ];

    const solution = [
      [1, 2, 3, 4],
      [4, 3, 1, 2],
      [3, 4, 2, 1],
      [2, 1, 4, 3]
    ];

    function renderSudoku(root) {
      let html = '<div style="max-width: 260px; font-family: system-ui, sans-serif;">';
      html += '<div style="margin-bottom: 8px; font-weight: 600;">Mini Sudoku</div>';
      html += '<table style="border-collapse: collapse; width: 100%;">';

      for (let r = 0; r < 4; r++) {
        html += '<tr>';
        for (let c = 0; c < 4; c++) {
          const val = puzzle[r][c];
          const borderStyle = 'border: 1px solid #ccc;';
          html += '<td style="width: 25%; padding: 0; text-align: center; ' + borderStyle + '">';

          if (val === null) {
            html += '<input ' +
              'data-r="' + r + '" ' +
              'data-c="' + c + '" ' +
              'maxlength="1" ' +
              'style="width: 100%; height: 48px; text-align: center; border: none; outline: none; font-size: 18px;" />';
          } else {
            html += '<div style="width: 100%; height: 48px; line-height: 48px; font-size: 18px;">' + val + '</div>';
          }

          html += '</td>';
        }
        html += '</tr>';
      }

      html += '</table>';
      html += '<button id="sudoku-check-btn" style="margin-top: 8px; padding: 6px 10px; border-radius: 4px; border: 1px solid #333; background: #111; color: #fff; cursor: pointer; font-size: 14px;">Check puzzle</button>';
      html += '<div id="sudoku-message" style="margin-top: 6px; font-size: 14px;"></div>';
      html += '</div>';

      root.innerHTML = html;
    }

    function attachEvents(root) {
      const btn = root.querySelector('#sudoku-check-btn');
      const messageEl = root.querySelector('#sudoku-message');

      btn.addEventListener('click', function() {
        let allFilled = true;
        let allCorrect = true;

        const inputs = root.querySelectorAll('input[data-r][data-c]');
        inputs.forEach(function(input) {
          const r = parseInt(input.getAttribute('data-r'), 10);
          const c = parseInt(input.getAttribute('data-c'), 10);
          const userVal = input.value.trim();

          // Reset styling each time
          input.style.backgroundColor = '';

          if (userVal === '') {
            allFilled = false;
            allCorrect = false;
          } else {
            const num = parseInt(userVal, 10);
            if (num !== solution[r][c]) {
              allCorrect = false;
              // Highlight wrong cells
              input.style.backgroundColor = '#ffe0e0';
            }
          }
        });

        if (!allFilled) {
          messageEl.textContent = 'Fill in all empty cells before checking.';
          messageEl.style.color = '#b45309'; // amber-ish
        } else if (allCorrect) {
          messageEl.textContent = 'Nice! You solved this puzzle ðŸŽ‰';
          messageEl.style.color = '#15803d'; // green
        } else {
          messageEl.textContent = 'Some cells are incorrect. Try again!';
          messageEl.style.color = '#b91c1c'; // red
        }
      });
    }

    const root = document.getElementById('sudoku-root');
    if (root) {
      renderSudoku(root);
      attachEvents(root);
    }
  })();
</script>